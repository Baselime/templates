api-errors:
  type: query
  properties:
    parameters:
      datasets:
        - apigateway-logs
      calculations:
        - COUNT
      filters:
        - status > = 400
      groupBy:
        type: number
        value: status
        limit: 10
        orderBy: COUNT
        order: DESC

api-errors-alarm:
  type: alert
  properties:
    name: API errors alarm
    description: More than {{ threshold }} errors in {{ window}}
    enabled: true
    parameters:
      query: !ref api-errors
      frequency: 30mins
      window: 10mins
      threshold: "> 100"
    channels:
      - type: slack
        targets:
          - baselime-alerts
