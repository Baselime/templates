request-count:
  type: query
  properties:
    name: "Request Count"
    description: Total number of requests made to the API Gateway
    parameters:
      datasets:
        - apigateway-logs
      calculations:
        - COUNT

request-count-alert:
  type: alert
  properties:
    name: "Request Count Alert"
    description: If the number of requests made to the API Gateway exceeds 60000 in a 1 minute period, trigger an alarm
    parameters:
      query: !ref request-count
      frequency: 60mins
      window: 1min
      threshold: "> 60000"
    channels:
      - type: slack
        targets:
          - baselime-alerts
